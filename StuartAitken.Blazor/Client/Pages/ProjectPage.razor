@page "/projects/{ProjectId:int}"

@inherits CustomComponentBase

<PageTitle>Stuart Aitken - @(project?.Name ?? "Project")</PageTitle>

	<div>
		<MudIconButton OnClick="@(() => Navigation.NavigateTo(Routes.Pages.Projects))"
				   Icon="@Icons.Rounded.ArrowBack" Color="Color.Info" />


		.. / <MudLink Href="@(Routes.Pages.Projects)" Color="Color.Default">Projects</MudLink> / @(project?.Name ?? "Loading...")

	@if (this.IsAdmin)
	{
		<MudButton Variant="Variant.Filled"
			   Style="@($"background-color:{Colors.Blue.Default};color:{Colors.Grey.Lighten5};margin:10px;float:right")"
			   Size="Size.Small"
			   OnClick="@(() => this.Navigation.NavigateTo($"{Routes.Pages.EditProject}/{ProjectId}"))">
			Edit
		</MudButton>
	}
</div>

<ProjectComponent Project="project" />

@code {
	[Parameter]
	public int ProjectId { get; set; }

	public Project project;

	protected override async Task OnParametersSetAsync()
	{
		var data = await Http.GetFromJsonAsync<Project>($"{Routes.Api.Projects}{this.ProjectId}");

		if (data == null)
		{
			Snackbar.Add("Found no data!", Severity.Error);
		}
		else
		{
			project = data;
			this.StateHasChanged();
		}

		await base.OnParametersSetAsync();
	}
}
